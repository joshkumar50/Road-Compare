# ðŸ”§ RoadCompare - Troubleshooting Guide

## Issue: "Failed to upload videos" / Network Errors

### Symptoms
- Frontend shows "Failed to upload videos"
- Console shows `ERR_CONNECTION_CLOSED` or network errors
- Cannot reach backend API

### Root Causes & Solutions

#### 1. **Backend API Not Responding**

**Check Status:**
```bash
# Check if backend is running
curl https://roadcompare-api.onrender.com/health
```

**Solutions:**
- **Render Service Down**: Check Render dashboard â†’ Services â†’ roadcompare-api
  - If service is down, click "Restart" or "Redeploy"
  - Check logs for errors
  
- **Cold Start**: Render free tier services sleep after 15 minutes of inactivity
  - First request will take 30-60 seconds to wake up
  - Wait and retry

- **Database Connection**: Check if PostgreSQL is running
  - Render Dashboard â†’ Databases â†’ roadcompare-db
  - Verify connection string in environment variables

- **Redis Connection**: Check if Redis is running
  - Render Dashboard â†’ Services â†’ roadcompare-redis
  - Verify connection string in environment variables

#### 2. **Frontend API Endpoint Not Configured**

**Check Configuration:**
- Vercel Dashboard â†’ Settings â†’ Environment Variables
- Should have `VITE_API=https://roadcompare-api.onrender.com/api/v1`

**Fix:**
1. Go to Vercel Project Settings
2. Add Environment Variable:
   - Name: `VITE_API`
   - Value: `https://roadcompare-api.onrender.com/api/v1`
3. Redeploy frontend

#### 3. **CORS Issues**

**Symptoms:**
- API responds but frontend gets CORS error
- Console shows "Access-Control-Allow-Origin" error

**Fix:**
1. Check `render.yaml` - `FRONTEND_URL` must match Vercel domain
2. Should be: `https://roadcompare.vercel.app`
3. Redeploy backend if changed

#### 4. **S3/MinIO Storage Not Configured**

**Symptoms:**
- Upload fails after API call succeeds
- Storage errors in backend logs

**Fix:**
1. Verify AWS credentials in Render environment:
   - `AWS_ACCESS_KEY_ID`
   - `AWS_SECRET_ACCESS_KEY`
2. Or configure MinIO:
   - `MINIO_ROOT_USER`
   - `MINIO_ROOT_PASSWORD`
3. Redeploy backend

---

## Issue: Deployment Not Updating

### Symptoms
- Changes pushed to GitHub but not reflected in live app
- Old code still running

### Solutions

#### Frontend (Vercel)
1. Check Vercel Deployments tab
2. If deployment failed, check build logs
3. Manual redeploy:
   - Vercel Dashboard â†’ Deployments â†’ Redeploy

#### Backend (Render)
1. Check Render Deployments tab
2. If deployment failed, check build logs
3. Manual redeploy:
   - Render Dashboard â†’ Services â†’ roadcompare-api â†’ Manual Deploy

---

## Issue: Database Connection Error

### Symptoms
- Backend logs show database connection error
- Jobs not being saved

### Solutions

1. **Check PostgreSQL Status**
   - Render Dashboard â†’ Databases â†’ roadcompare-db
   - Verify it's running

2. **Verify Connection String**
   - Check `DATABASE_URL` in render.yaml
   - Should be auto-generated by Render

3. **Reset Database**
   - Render Dashboard â†’ Databases â†’ roadcompare-db â†’ Delete
   - Redeploy backend (will create new database)

---

## Issue: Redis Connection Error

### Symptoms
- Background jobs not processing
- Redis connection timeout

### Solutions

1. **Check Redis Status**
   - Render Dashboard â†’ Services â†’ roadcompare-redis
   - Verify it's running

2. **Verify Connection String**
   - Check `REDIS_URL` in render.yaml
   - Should be auto-generated by Render

3. **Restart Redis**
   - Render Dashboard â†’ Services â†’ roadcompare-redis â†’ Restart

---

## Issue: Video Processing Hangs

### Symptoms
- Job status stays "processing" indefinitely
- No results after 5+ minutes

### Solutions

1. **Check Worker Thread**
   - Backend logs should show processing messages
   - If no logs, worker thread may have crashed

2. **Restart Backend**
   - Render Dashboard â†’ Services â†’ roadcompare-api â†’ Restart

3. **Check Video File**
   - Ensure video is valid MP4/WebM
   - File size should be < 100MB
   - Duration should be < 5 minutes

4. **Check Logs**
   - Render Dashboard â†’ Services â†’ roadcompare-api â†’ Logs
   - Look for error messages

---

## Issue: PDF Export Not Working

### Symptoms
- "Download PDF" button doesn't work
- No PDF file generated

### Solutions

1. **Check WeasyPrint Installation**
   - Backend logs should show PDF generation
   - If error, may need to rebuild dependencies

2. **Verify Storage Access**
   - PDF is saved to S3/MinIO
   - Check storage configuration

3. **Restart Backend**
   - Render Dashboard â†’ Services â†’ roadcompare-api â†’ Restart

---

## Issue: Delete Operations Not Working

### Symptoms
- Delete button doesn't work
- Job still appears after deletion

### Solutions

1. **Check Database Connection**
   - Verify PostgreSQL is running
   - Check connection string

2. **Check Storage Access**
   - Verify S3/MinIO credentials
   - Storage files should be deleted

3. **Check Backend Logs**
   - Render Dashboard â†’ Services â†’ roadcompare-api â†’ Logs
   - Look for delete operation errors

---

## Local Development Troubleshooting

### Backend Won't Start

**Error: `ModuleNotFoundError`**
```bash
# Solution: Install dependencies
cd backend
pip install -r requirements.txt
```

**Error: `Port 8000 already in use`**
```bash
# Solution: Use different port
uvicorn app.main:app --reload --port 8001
```

**Error: `Database connection refused`**
```bash
# Solution: Ensure PostgreSQL is running locally
# Or use environment variable:
export DATABASE_URL=sqlite:///./test.db
```

### Frontend Won't Start

**Error: `npm ERR! code ERESOLVE`**
```bash
# Solution: Use legacy peer deps
npm install --legacy-peer-deps
npm run dev
```

**Error: `VITE_API not defined`**
```bash
# Solution: Create .env file
echo "VITE_API=http://localhost:8000/api/v1" > frontend/.env
npm run dev
```

---

## Performance Issues

### Slow Video Processing

**Solutions:**
1. Reduce frame rate: `FRAME_RATE=0.5` (process every 2 seconds)
2. Reduce video resolution before upload
3. Use GPU if available (check Render plan)

### High Memory Usage

**Solutions:**
1. Reduce `TEMPORAL_PERSIST_N` (default: 3)
2. Process shorter videos
3. Upgrade Render plan

### Slow API Response

**Solutions:**
1. Check Render CPU usage
2. Restart service if stuck
3. Upgrade plan if consistently slow

---

## Monitoring & Logs

### View Backend Logs
```bash
# Render Dashboard
Services â†’ roadcompare-api â†’ Logs
```

### View Frontend Logs
```bash
# Browser Console
F12 â†’ Console tab
```

### View Database Logs
```bash
# Render Dashboard
Databases â†’ roadcompare-db â†’ Logs
```

---

## Emergency Procedures

### Full System Reset

1. **Delete all services** (Render Dashboard)
   - Services â†’ Delete each service
   - Databases â†’ Delete database

2. **Redeploy from scratch**
   - Render Dashboard â†’ New â†’ Web Service
   - Connect GitHub repo
   - Select `render.yaml`
   - Deploy

3. **Redeploy frontend**
   - Vercel Dashboard â†’ Redeploy

### Rollback to Previous Version

```bash
# Find previous commit
git log --oneline

# Revert to previous version
git revert <commit-hash>
git push origin main

# Services will auto-redeploy
```

---

## Getting Help

1. **Check logs first**
   - Render logs for backend
   - Browser console for frontend
   - GitHub Actions for deployment

2. **Review documentation**
   - README.md
   - DEPLOY_RENDER_VERCEL.md
   - IMPLEMENTATION_SUMMARY.md

3. **Common issues**
   - Check this troubleshooting guide
   - Search GitHub issues

4. **Contact support**
   - Render Support: https://render.com/support
   - Vercel Support: https://vercel.com/support

---

## Quick Checklist

- [ ] Backend API responding (check `/health`)
- [ ] Frontend can reach API (check browser console)
- [ ] Database connected (check Render logs)
- [ ] Redis connected (check Render logs)
- [ ] S3/MinIO credentials configured
- [ ] FRONTEND_URL correct in render.yaml
- [ ] VITE_API correct in Vercel
- [ ] Services not in cold start state
- [ ] No uncommitted changes in git
- [ ] Recent deployment successful

---

*Last Updated: November 6, 2025*
